package org.phlo.tuplez.tests;

import java.math.BigDecimal;

import org.phlo.tuplez.operation.*;

public class Statements {
	public String getDescription() {
		return "test entry";
	}
	
	public enum Kind { KIND_OF_COOL, KIND_OF_SUCKS }
	
	public interface TestNew {
		String getStr();
		BigDecimal getDez();
		java.sql.Date getDay();
		Integer getIdx();
		String getDescription();
		Kind getKind();
		Class<?> getNoSuchColumn();
	}
	
	public interface TestFull extends TestNew {
		Long getId();
	}

	
	@Statement("CREATE TABLE test (" +
		"id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000) NOT NULL PRIMARY KEY, " +
		"str VARCHAR(256) DEFAULT NULL, " +
		"dez DECIMAL(31,15) DEFAULT NULL, " +
		"day DATE DEFAULT NULL," +
		"idx INTEGER DEFAULT NULL," +
		"des VARCHAR(256)," +
		"kind VARCHAR(256)" +
	")")
	public interface CreateTest extends Operation<Void, Void> {}
	
	
	@Statement("CREATE TABLE SINGLE (unit INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL)")
	public interface CreateSingle extends Operation<Void, Void> {}

	
	@Statement("INSERT INTO SINGLE (unit) VALUES (DEFAULT)")
	public interface InsertSingle extends OperationGeneratesKey<Void, Integer> {}

		
	@Statement("DELETE FROM test")
	public interface TestDelete extends Operation<Void, Void> {}
	
	
	@Statement("INSERT INTO test (" +
			"id, str, dez, day, idx, des, kind" +
		") VALUES (" +
			":in.id, :in.str, :in.dez, :in.day, :in.idx, :default.description, :in.kind" +
	")")
	public interface TestInsert extends Operation<TestFull, Void> {}
	
	
	@Statement("INSERT INTO test (" +
			"str, dez, day, idx, des, kind" +
		") VALUES (" +
			":in.str, :in.dez, :in.day, :in.idx, :default.description, :in.kind" +
	")")
	@KeyColumn("ID")
	public interface TestInsertGenerateId extends OperationGeneratesKey<TestNew, Long> {}

	
	@Statement("INSERT INTO test (" +
			"id, des "+
		") VALUES (" +
			":in, :default.description" +
	")")
	public interface TestInsertId extends Operation<Long, Void> {}

	
	@Statement("SELECT id, str, dez, day, idx, des as \"description\", kind " +
		"FROM test " +
		"WHERE " +
			"(id = :in.id OR (id IS NULL AND :in.id IS NULL)) AND " +
			"(str = :in.str OR (str IS NULL AND :in.str IS NULL)) AND " +
			"(dez = :in.dez OR (dez IS NULL AND :in.dez IS NULL)) AND " +
			"(day = :in.day OR (day IS NULL AND :in.day IS NULL)) AND " +
			"(idx = :in.idx OR (idx IS NULL AND :in.idx IS NULL)) AND " +
			"(kind = :in.kind OR (kind IS NULL AND :in.kind IS NULL))"
	)
	public interface TestFromFull extends OperationReturnsSingleRow<TestFull, TestFull> {}

	
	@Statement("SELECT " +
			"id, str as string, dez as dezimal, day AS \"day\", idx AS \"idx\", des, kind " +
		"FROM test " +
		"WHERE " +
			"(id = :in.id OR (id IS NULL AND :in.id IS NULL)) AND " +
			"(str = :in.str OR (str IS NULL AND :in.str IS NULL)) AND " +
			"(dez = :in.dez OR (dez IS NULL AND :in.dez IS NULL)) AND " +
			"(day = :in.day OR (day IS NULL AND :in.day IS NULL)) AND " +
			"(idx = :in.idx OR (idx IS NULL AND :in.idx IS NULL))"
	)
	@OutputMapping({
		@OutputColumn(column="ID", getter="getId"),
		@OutputColumn(column="STRING", getter="getStr"),
		@OutputColumn(column="DECIMAL", getter="getDez", jdbcAccessor="getBigDecimal"),
		@OutputColumn(column="DAY", jdbcAccessor="getObject"),
		@OutputColumn(column="DES", getter="getDescription")
	})
	public interface TestFromFullAnnotated extends TestFromFull {}
	
	
	@Statement("SELECT str FROM test WHERE id = :in")
	public interface TestIdToStr extends OperationReturnsSingleRow<Long, String> {}
	
	
	@Statement("SELECT id, str, dez, day, idx, des as \"description\", kind " +
		"FROM test " +
		"WHERE id = :in"
	)
	public interface TestIdToFull extends OperationReturnsSingleRow<Integer, TestFull> {}
	
	
	@Statement("SELECT id, str, dez, day, idx, des as \"description\", kind FROM test ORDER BY id")
	public static abstract class TestAllFull implements Operation<Void, TestFull> {}
	
	
	public static abstract class TestResultSize implements
		OperationReturnsSingleRow<Integer, String>,
		OperationStatementIsComputed<Integer, String>
	{
		@Override
		public String getStatement(Integer input) {
			StringBuilder b = new StringBuilder();
			for(int i=0; i < input; ++i) {
				if (i > 0)
					b.append(" union all ");
				b.append("select 'Row " + (i+1) + "' from single");
			}
			return b.toString();
		}
	}
	

	public abstract class TestNonStatic implements
		OperationStatementIsComputed<Void, Void>
	{
		@Override public String getStatement(Void input) { return null; }
	}

	
	public static abstract class TestNoDefaultConstructor implements
		OperationStatementIsComputed<Void, Void>
	{
		public TestNoDefaultConstructor(String dummy) {}
		@Override public String getStatement(Void input) { return null; }
	}

	
	public interface TestNoStatement extends Operation<Void, Void> {}
	
	
	@Statement("")
	public static abstract class TestAmbiguousStatement implements
		OperationStatementIsComputed<Void, Void>
	{
		@Override public String getStatement(Void input) { return null; }
	}
}
	
